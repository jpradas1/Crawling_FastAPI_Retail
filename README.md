# Crawling Engineer FastAPI

This repository builds up an API service to consume data generated by the scraper [Crawling_Engineer_Retail](https://github.com/jpradas1/Crawling_Engineer_Retail), which extracts data over thousand of available products in [Puma](https://eu.puma.com/).

The folder [dataset](https://github.com/jpradas1/Crawling_FastAPI_Retail/tree/main/dataset) contains a bson file with wich we create the MongoDB database.

## Creating MongoDB Database
The python script `mongo.py` automatically creates the database using the bson file in [dataset](https://github.com/jpradas1/Crawling_FastAPI_Retail/tree/main/dataset) folder, although the MongoClient needs the url server. First we need to untar the file:
```
cd dataset
tar -xzvf products.tar.gz
```
### Local
We can create a local MongoDB server using Docker.
```
sudo docker pull mongo
sudo docker run -d -p 27017:27017 --name mongodb mongo
```
Save the Mongo URI connection as a environment variable
```
export MONGO_URL="mongodb://localhost:27017/"
```
## Virtual Environment
Additionally we need a environment to run our project, then
```
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```
Finally run `mongo.py` to create our database
```
python3 mongo.py
```
Hence we create a database named as **Products** with a collection **product_items**, each document is a product from the stores.
### Cloud
If you have a Mongo server on cloud you need the url connection and save it as a environment variable.
```
export MONGO_URL="mongodb://{MONGOUSER}:{MONGOPASSWORD}@{MONGOHOST}:{MONGOPORT}"
```
or for Windows
```
set MONGO_URL="mongodb://{MONGOUSER}:{MONGOPASSWORD}@{MONGOHOST}:{MONGOPORT}"
```
Then run `mongo.py`.
## Run FastAPI Locally
To run this project locally using whatever Mongo server, just run

### Mongo Local Server
```
uvicorn main:app --reload
```
### Mongo Cloud Server
```
MONGO_URL="mongodb://{MONGOUSER}:{MONGOPASSWORD}@{MONGOHOST}:{MONGOPORT}" uvicorn main:app --reload
```
Finally, you can start to consume data on `localhost:8000/` and documentation on `localhost:8000/docs`.
